<?xml version="1.0"?>
<!--
/**
 * Magestore
 * 
 * NOTICE OF LICENSE
 * 
 * This source file is subject to the Magestore.com license that is
 * available through the world-wide-web at this URL:
 * http://www.magestore.com/license-agreement.html
 * 
 * DISCLAIMER
 * 
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 * 
 * @category    Magestore
 * @package     Magestore_Webpos
 * @copyright   Copyright (c) 2012 Magestore (http://www.magestore.com/)
 * @license     http://www.magestore.com/license-agreement.html
 */
-->
<config>
    <modules>
        <Magestore_Webpos>
            <version>0.1.2</version>
        </Magestore_Webpos>
    </modules>
    <frontend>
        <routers>
            <webpos>
                <use>standard</use>
                <args>
                    <module>Magestore_Webpos</module>
                    <frontName>webpos</frontName>
                </args>
            </webpos>
        </routers>
        <layout>
            <updates>
                <webpos>
                    <file>webpos.xml</file>
                </webpos>
            </updates>
        </layout>
        <translate>
            <modules>
                <Magestore_Webpos>
                    <files>
                        <default>Magestore_Webpos.csv</default>
                    </files>
                </Magestore_Webpos>
            </modules>
        </translate>
		
		<events>
		<!-- cart -->
			<controller_action_predispatch_catalog_product_view>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>catalogProductView</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_catalog_product_view>
			<controller_action_predispatch_checkout_cart_add>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartAdd</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_add>
			<controller_action_predispatch_checkout_cart_delete>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartDelete</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_delete>
			<controller_action_predispatch_checkout_cart_configure>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartConfigure</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_configure>
			<controller_action_predispatch_checkout_cart_updateItemOptions>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartUpdateItemOptions</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_updateItemOptions>
			<controller_action_predispatch_checkout_cart_index>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartIndex</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_index>
			<controller_action_predispatch_webpos_index_cart>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartIndex</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_webpos_index_cart>
			<controller_action_predispatch_checkout_cart_updatePost>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartUpdatePost</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_updatePost>
			<controller_action_predispatch_checkout_cart_estimateUpdatePost>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartEstimateUpdatePost</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_estimateUpdatePost>
			<controller_action_predispatch_checkout_cart_couponPost>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartCouponPost</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_couponPost>
			<controller_action_predispatch_checkout_cart_estimatePost>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/cart</class>
        				<method>checkoutCartEstimatePost</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_checkout_cart_estimatePost>
		<!-- endcart -->
		
		<!-- webpos skip active payment method -->
			<payment_method_is_active>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/observer</class>
        				<method>skipPaymentMethod</method>
					</webpos_observers>
				</observers>
			</payment_method_is_active>
		<!-- end webpos skip active payment method -->
		<!--place order -->
			<sales_order_place_after>
				<observers>
					<webpos_observers>
						<type>singleton</type>
						<class>webpos/observer</class>
						<method>orderPlaceAfter</method>
					</webpos_observers>
				</observers>
			</sales_order_place_after>
		<!-- end place order -->
		<!-- paypal -->
			<paypal_prepare_line_items>
				<observers>
					<magestore_webpos_paypal_prepare_line_items>
						<type>singleton</type>
						<class>webpos/giftwrap</class>
						<method>paypal_prepare_line_items</method>
					</magestore_webpos_paypal_prepare_line_items>
				</observers>
			</paypal_prepare_line_items>
		<!-- paypal -->
		</events>
    </frontend>
    <admin>
        <routers>
            <webposadmin>
                <use>admin</use>
                <args>
                    <module>Magestore_Webpos</module>
                    <frontName>webposadmin</frontName>
                </args>
            </webposadmin>
        </routers>
    </admin>
    <adminhtml>
        <layout>
            <updates>
                <webpos>
                    <file>webpos.xml</file>
                </webpos>
            </updates>
        </layout>
        <translate>
            <modules>
                <Magestore_Webpos>
                    <files>
                        <default>Magestore_Webpos.csv</default>
                    </files>
                </Magestore_Webpos>
            </modules>
        </translate>
    </adminhtml>   
    <global>
        <models>
            <webpos>
                <class>Magestore_Webpos_Model</class>
                <resourceModel>webpos_mysql4</resourceModel>
            </webpos>
            <webpos_mysql4>
                <class>Magestore_Webpos_Model_Mysql4</class>
                <entities>
                    <admin>
                        <table>webpos_admin</table>
                    </admin>
					<survey>
						<table>webpos_survey</table>
					</survey>
                </entities>
            </webpos_mysql4>
<!--            <rewardpointsrule>
                <rewrite>
                    <total_quote_catalog>Magestore_Webpos_Model_Total_Quote_Catalog</total_quote_catalog>
                </rewrite>
            </rewardpointsrule>-->
        </models>
        <resources>
            <webpos_setup>
                <setup>
                    <module>Magestore_Webpos</module>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </webpos_setup>
            <webpos_write>
                <connection>
                    <use>core_write</use>
                </connection>
            </webpos_write>
            <webpos_read>
                <connection>
                    <use>core_read</use>
                </connection>
            </webpos_read>
        </resources>
        <blocks>
            <webpos>
                <class>Magestore_Webpos_Block</class>
            </webpos>
			<payment>  
                <rewrite>  
                    <!-- <form_cc>Magestore_Webpos_Block_Payment_Cc</form_cc>   -->
                    <form_ccsave>Magestore_Webpos_Block_Payment_Ccsave</form_ccsave>                      
                </rewrite>  
            </payment>  
        </blocks>
        <helpers>
            <webpos>
                <class>Magestore_Webpos_Helper</class>
            </webpos>
<!--            <rewardpointsrule>
                <rewrite>
                    <calculation_earning>Magestore_Webpos_Helper_Rewrite_Earning</calculation_earning>
                    <calculation_spending>Magestore_Webpos_Helper_Rewrite_Spending</calculation_spending>
                </rewrite>
            </rewardpointsrule>-->
        </helpers>
		<sales>
			<quote>
				<totals>
					<weboposgiftwrap>
						<class>webpos/sales_quote_address_total_giftwrap</class>
						<after>wee,discount,tax,tax_subtotal,grand_total</after>
					</weboposgiftwrap>					
					<webposdiscount>
						<class>webpos/sales_quote_address_total_discount</class>
						<after>wee,discount,tax,tax_subtotal,shipping,grand_total,subtotal</after>
					</webposdiscount>					
				</totals>
			</quote>
			<order_invoice>
				<totals>
					<weboposgiftwrap>
						<class>webpos/sales_order_invoice_total_giftwrap</class>
					</weboposgiftwrap>
					<webposdiscount>
						<class>webpos/sales_order_invoice_total_discount</class>
					</webposdiscount>
				</totals>
			</order_invoice>
			<order_creditmemo>
				<totals>
					<weboposgiftwrap>
						<class>webpos/sales_order_invoice_total_giftwrap</class>
					</weboposgiftwrap>
					<webposdiscount>
						<class>webpos/sales_order_invoice_total_discount</class>
					</webposdiscount>
				</totals>
			</order_creditmemo>
		</sales>
		<fieldsets>
            <sales_convert_quote_address>
                <webpos_giftwrap_amount>
                    <to_order>*</to_order>
                </webpos_giftwrap_amount>
				<webpos_discount_amount>
                    <to_order>*</to_order>
                </webpos_discount_amount>                
            </sales_convert_quote_address>
        </fieldsets>
		<!-- <pdf>
			<totals>
				<giftwrap translate="title">
					<title>Giftwrap</title>
					<source_field>giftwrap_amount</source_field>
					<model>webpos/order_pdf_amount</model>
					<font_size>7</font_size>
					<display_zero>0</display_zero>
					<sort_order>450</sort_order>
				</giftwrap>
			</totals>			
		</pdf> -->
        <events>
			<controller_action_predispatch_adminhtml_index_logout>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/observer</class>
        				<method>adminlogout</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_adminhtml_index_logout>
			<controller_action_predispatch_adminhtml_index_login>
				<observers>
					<webpos_observers>
						<type>singleton</type>
        				<class>webpos/observer</class>
        				<method>adminlogin</method>
					</webpos_observers>
				</observers>
			</controller_action_predispatch_adminhtml_index_login>
			
			<checkout_type_onepage_save_order>
				<observers>
					<magestore_webpos_observer>
						<type>singleton</type>
						<class>Magestore_Webpos_Helper_Data</class>
						<method>saveOrderComment</method>
					</magestore_webpos_observer>
				</observers>
			</checkout_type_onepage_save_order>
        </events>
<!--        <sales>
            <quote>
                <totals>
                    <webpos_catalog>
                        <class>webpos/total_quote_catalog</class>
                        <after>subtotal</after>
                        <before>rewardpoints</before>
                    </webpos_catalog>
                </totals>
            </quote>
        </sales>-->
    </global>
	<default>
		<webpos>
                    <rewardpoints>
                        <enable_rewardpoints>1</enable_rewardpoints>
                    </rewardpoints>
			<general>
				<active>1</active>
				<show_shipping_address>1</show_shipping_address>
				<country_id>US</country_id>
				<postcode>90034</postcode>				
				<region_id>12</region_id>
				<page_layout>3columns</page_layout>				
			</general>
			<field_position_management>
				<position>test</position>
				<row_0>firstname</row_0>
				<row_1>lastname</row_1>
				<row_2>email</row_2>
				<row_3>telephone</row_3>
				<row_4>street</row_4>
				<row_5>0</row_5>
				<row_6>country</row_6>
				<row_7>0</row_7>
				<row_8>city</row_8>
				<row_9>0</row_9>
				<row_10>postcode</row_10>
				<row_11>region</row_11>
				<row_12>company</row_12>
				<row_13>fax</row_13>
				<row_14>0</row_14>
			</field_position_management>
			<field_require_management>
				<firstname>1</firstname>
				<lastname>1</lastname>
				<email>1</email>
				<company>0</company>
				<street>1</street>
				<country>1</country>
				<region>0</region>
				<city>1</city>
				<postcode>1</postcode>
				<telephone>1</telephone>
				<fax>0</fax>
				
			</field_require_management>

			<ajax_update>
				<enable_ajax>1</enable_ajax>
				<ajax_fields>country,postcode,state/region,city</ajax_fields>
				<update_payment>1</update_payment>
				<reload_payment>1</reload_payment>
				<check_email>0</check_email>
				<show_popup>0</show_popup>
			</ajax_update>
			<payment>
				<allowspecific_payment>0</allowspecific_payment>
			</payment>
			<admin>
				<rows>5</rows>
			</admin>
			<product>
				<bundle>webpos/product_bundle</bundle>
				<giftvoucher>webpos/product_giftvoucher</giftvoucher>
				<grouped>webpos/product_grouped</grouped>
				<configurable>webpos/product_configurable</configurable>
				<minicart>0</minicart>
			</product>
		</webpos>
	</default>
</config>